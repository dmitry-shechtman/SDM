#include "lolevel.h"
#include "platform.h"
#include "core.h"
static long *nrflag = (long*)(0x5a8c+0x08);  // Found @ ffd1d88c & ffd1d8d0 - both from stubs_entry.s
#define NR_AUTO (0)                          // have to explictly reset value back to 0 to enable auto
//#define PAUSE_FOR_FILE_COUNTER 100          // Enable delay in capt_seq_hook_raw_here to ensure file counter is updated -idem acima

#include "../../../generic/capt_seq.c"		//here from defined NR_AUTO definido initializes nrflag


//ffc5b06c
void __attribute__((naked,noinline)) capt_seq_task() {
	asm volatile (
		"push	{r3, r4, r5, r6, r7, lr}\n"
		"ldr	r5, =0x33d88\n" //[pc, #836]	; ffc5b3bc: (00033d88) \n"
		"ldr	r6, =0x2710\n" //[pc, #-1060]	; ffc5ac58: (00002710) \n"
"loc_ffc5b078:\n"
		"mov	r2, #0\n"
		"ldr	r0, [r6, #4]\n"
		"mov	r1, sp\n"
		"BL		sub_FFC2905C\n"
		"tst	r0, #1\n"
		"BEQ	loc_ffc5b0a4\n"
		"ldr	r1, =0x476\n" //[pc, #872]	; ffc5b400: (00000476) \n"
		"ldr	r0, =0xffc5ac5c\n" //[pc, #864]	; ffc5b3fc: (ffc5ac5c)  **"SsShootTask.c"\n"
		"BL		_DebugAssert\n" //sub_FFC0F768
		"BL		_ExitTask\n"	//FFC0F520\n"
		"pop	{r3, r4, r5, r6, r7, pc}\n"
"loc_ffc5b0a4:\n"
		"ldr	r0, [sp]\n"
		"ldr	r1, [r0]\n"
		"cmp	r1, #30\n"
		"addcc	pc, pc, r1, lsl #2\n"
		"B	loc_ffc5b27c\n"
		"B	loc_ffc5b130\n"
		"B	loc_ffc5b138\n"
		"B	loc_ffc5b164\n"
		"B	loc_ffc5b178\n"
		"B	loc_ffc5b170\n"
		"B	loc_ffc5b180\n"
		"B	loc_ffc5b188\n"
		"B	loc_ffc5b194\n"
		"B	loc_ffc5b1b0\n"
		"B	loc_ffc5b178\n"
		"B	loc_ffc5b1b8\n"
		"B	loc_ffc5b1c4\n"
		"B	loc_ffc5b1cc\n"
		"B	loc_ffc5b1d4\n"
		"B	loc_ffc5b1dc\n"
		"B	loc_ffc5b1e4\n"
		"B	loc_ffc5b1ec\n"
		"B	loc_ffc5b1f4\n"
		"B	loc_ffc5b200\n"
		"B	loc_ffc5b208\n"
		"B	loc_ffc5b210\n"
		"B	loc_ffc5b218\n"
		"B	loc_ffc5b220\n"
		"B	loc_ffc5b22c\n"
		"B	loc_ffc5b234\n"
		"B	loc_ffc5b23c\n"
		"B	loc_ffc5b244\n"
		"B	loc_ffc5b24c\n"
		"B	loc_ffc5b258\n"
		"B	loc_ffc5b288\n"
"loc_ffc5b130:\n"
		//"BL		shooting_expo_iso_override\n"  		    // added - as ixus220 - but not defined for a800
		"BL		sub_FFC5B7BC\n"
		"BL      shooting_expo_param_override\n"      // +
		"B		loc_ffc5b18c\n"
"loc_ffc5b138:\n"
            "BL    shooting_set_flash_override\n"
		//"BL     wait_until_remote_button_is_released\n"	// +++ as in ixus310
		"BL     capt_seq_hook_set_nr\n"           		// +++ as in ixus310
		"ldr	r7, [r0, #12]\n"
		"mov	r0, r7\n"
		"BL		sub_FFD1CA20_my\n"
		"BL     capt_seq_hook_raw_here\n"           // as in ixus220				 
		"mov	r4, r0\n"
		"mov	r2, r7\n"
		"mov	r1, #1\n"
		"BL		sub_FFC59678\n"
		"tst	r4, #1\n"
		"moveq	r0, r7\n"
		"BLEQ	sub_FFD1C558\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b164:\n"
		"mov	r0, #1\n"
		"BL		sub_FFC5BA38\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b170:\n"
		"BL		sub_FFC5B494\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b178:\n" // ; 2 refs\n"
		"BL		sub_FFC5B79C\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b180:\n"
		"BL		sub_FFC5B7A4\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b188:\n"
		"BL		sub_FFC5B94C\n"
"loc_ffc5b18c:\n" // ; 2 refs\n"
		"BL		sub_FFC591B0\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b194:\n"
		"ldr	r4, [r0, #12]\n"
		"mov	r0, r4\n"
		"BL		sub_FFD1CAC8\n"
		"mov	r2, r4\n"
		"mov	r1, #9\n"
		"BL		sub_FFC59678\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1b0:\n"
		"BL		sub_FFC5B9B0\n"
		"B		loc_ffc5b18c\n"
"loc_ffc5b1b8:\n"
		"ldr	r0, [r5, #80]\n" //	; 0x50\n"
		"BL		sub_FFC5BE4C\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1c4:\n"
		"BL		sub_FFC5C194\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1cc:\n"
		"BL		sub_FFC5C1F8\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1d4:\n"
		"BL		sub_FFD1BAEC\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1dc:\n"
		"BL		sub_FFD1BCD8\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1e4:\n"
		"BL		sub_FFD1BD78\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1ec:\n"
		"BL		sub_FFD1BE38\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1f4:\n"
		"mov	r0, #0\n"
		"BL		sub_FFD1C030\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b200:\n"
		"BL		sub_FFD1C19C\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b208:\n"
		"BL		sub_FFD1C240\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b210:\n"
		"BL		sub_FFD1C320\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b218:\n"
		"BL		sub_FFC5BBA0\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b220:\n"
		"BL		sub_FFC5BBCC\n"
		"BL		sub_FFC270EC\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b22c:\n"
		"BL		sub_FFD1BEFC\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b234:\n"
		"BL		sub_FFD1BF3C\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b23c:\n"
		"BL		sub_FFC5DFDC\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b244:\n"
		"BL		sub_FFC5E048\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b24c:\n"
		"BL		sub_FFC5E0A4\n"
		"BL		sub_FFC5E064\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b258:\n"
		"ldrh	r0, [r5, #144]\n" //	; 0x90\n"
		"cmp	r0, #4\n"
		"ldrneh	r0, [r5]\n"
		"subne	r1, r0, #33280\n" //	; 0x8200\n"
		"subnes	r1, r1, #42\n" //	; 0x2a\n"
		"BNE	loc_ffc5b288\n"
		"BL		sub_FFC5E048\n"
		"BL		sub_FFC5E3D8\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b27c:\n"
		"ldr	r1, =0x5d7\n" //[pc, #384]	; ffc5b404: (000005d7) \n"
		"ldr	r0, =0xffc5ac5c\n" //[pc, #372]	; ffc5b3fc: (ffc5ac5c)  **"SsShootTask.c"\n"
		"BL		_DebugAssert\n"
"loc_ffc5b288:\n" //; 28 refs\n"
		"ldr	r0, [sp]\n"
		"ldr	r1, [r0, #4]\n"
		"ldr	r0, [r6]\n"
		"BL		sub_FFC28DCC\n"
		"ldr	r4, [sp]\n"
		"ldr	r0, [r4, #8]\n"
		"cmp	r0, #0\n"
		"ldreq	r0, =0xffc5ac5c\n" //[pc, #336]	; ffc5b3fc: (ffc5ac5c)  **"SsShootTask.c"\n"
		"moveq	r1, #280\n" //	; 0x118\n"
		"bleq	_DebugAssert\n"
		"mov	r0, #0\n"
		"str	r0, [r4, #8]\n"
		"B	loc_ffc5b078\n"
	);
}
//** sub_FFD1CA20
void __attribute__((naked,noinline)) sub_FFD1CA20_my() 
{
asm volatile (
"		STMFD	SP!, {R3-R5,LR}\n"
"		MOV	R4, R0\n"
"		MOV	R0, #0xC\n"
"		BL	sub_FFC5F898\n"
"		TST	R0, #1\n"
"		MOVNE	R0, #1\n"
"		BNE	loc_FFD1CAC4\n"
"		BL	sub_FFC5B7AC\n"
"		MOV	R0, R4\n"
"		BL	sub_FFD1C46C\n"
"		TST	R0, #1\n"
"		BNE	loc_FFD1CAC4\n"
"		MOV	R0, R4\n"
"		BL	sub_FFD1C70C\n"
"		BL	sub_FFD1D030\n"
"BL     wait_until_remote_button_is_released\n"
"		LDR	R0, =0x33D88\n"
"		LDRH	R0, [R0]\n"
"		SUB	R1, R0,	#0x8200\n"
"		SUBS	R1, R1,	#0x2D\n"
"		MOVNE	R0, R4\n"
"		LDMNEFD	SP!, {R3-R5,LR}\n"
"		BNE	sub_FFE16E48\n"
"		MOV	R5, #1\n"
"		MOV	R2, #2\n"
"		MOV	R1, SP\n"
"		ADD	R0, R2,	#0x15C\n"
"		STR	R5, [SP,#0]\n"
"		BL	sub_FFC6BA84\n"
"		TST	R0, #1\n"
"		MOVNE	R1, #0xBB\n"
//"		ADRNE	R0, =0xFFD1CB20\n" //SsCaptureSeq.c
"		LDRNE R0, =0xFFD1CB20\n" // "SsShootTask.c"
"		BLNE	sub_FFC0F768\n"
"		LDRH	R0, [SP,#0]\n"
"		CMP	R0, #1\n"
"		MOVHI	R0, #0x1D\n"
"		STRHI	R5, [R4,#0xD4]\n"
"		BHI	loc_FFD1CAC4\n"
"		MOV	R0, #0\n"
"		STR	R0, [R4,#0xD4]\n"
"		MOV	R0, R4\n"
"		BL	sub_FFE16E48\n"
"loc_FFD1CAC4:\n"
"		LDMFD	SP!, {R3-R5,PC}\n"
);

}



